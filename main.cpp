#ifdef build_platform_host

#define CATCH_CONFIG_MAIN
#include "build.h"
#include "test.h"

#else

#include "build.h"
#include "alt_ethernet.h"
#include "alt_watchdog.h"

struct [[gnu::packed]] Packet
{
    unsigned char destination[6];
    unsigned char source[6];
    unsigned short int type;
}; /* structure: Packet */

void delay()
{
    for (int i = 0; i < 100000; i++)
    {
        
    }
    
}

int main()
{
    alt_wdog_stop(ALT_WDOG1);

    alt_eth_emac_instance_t emac;

    emac.instance = 0;

    Packet packet;

    //7c0 control

    unsigned char ss[] = {
        0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
        0x00, 0x50, 0x56, 0xB8, 0xB4, 0x41, 
        0x08, 0x06, 0x00, 0x01, 0x08, 0x00, 
        0x06, 0x04, 0x00, 0x01, 0x00, 0x50, 
        0x56, 0xB8, 0xB4, 0x41, 0xC0, 0xA8, 
        0x00, 0x91, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0xC0, 0xA8, 0x00, 0x32, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
        0x99, 0x52, 0xCD, 0x38
    };
    
    auto result = alt_eth_dma_mac_config(&emac);

    while(1)
    {
        result = alt_eth_send_packet(ss, 60, 1, 1, &emac);

        delay();
    }
    

    while(1);
}

#endif
